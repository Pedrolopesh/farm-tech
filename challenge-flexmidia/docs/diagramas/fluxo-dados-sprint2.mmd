%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#2196F3'}}}%%

flowchart LR
    subgraph ENTRADA["üì• ENTRADA DE DADOS"]
        A1["ESP32-CAM<br/>Sensor de Presen√ßa"]
        A2["Interface Touch"]
        A3["Microfone"]
        A4["Script Simula√ß√£o<br/>simulated_sensors.py"]
    end

    subgraph COLETA["üìä COLETA"]
        B1["timestamp"]
        B2["ativacao (0/1)"]
        B3["tipo_interacao"]
        B4["tempo_permanencia"]
        B5["sessao_id"]
    end

    subgraph ARMAZENAMENTO["üóÑÔ∏è ARMAZENAMENTO"]
        C1["CSV Tempor√°rio<br/>simulated_sensors.csv"]
        C2["SQLite<br/>totem.db"]
        C3["Tabela interacoes"]
    end

    subgraph PROCESSAMENTO["‚öôÔ∏è PROCESSAMENTO"]
        D1["Limpeza de Dados"]
        D2["Remo√ß√£o Duplicados"]
        D3["Valida√ß√£o Campos"]
        D4["Feature Engineering"]
    end

    subgraph ANALISE["üìà AN√ÅLISE"]
        E1["Estat√≠sticas<br/>Descritivas"]
        E2["Visualiza√ß√µes"]
        E3["KPIs"]
    end

    subgraph ML["ü§ñ MACHINE LEARNING"]
        F1["Prepara√ß√£o<br/>Features"]
        F2["Treinamento<br/>RandomForest"]
        F3["Avalia√ß√£o<br/>M√©tricas"]
        F4["model.pkl"]
    end

    subgraph SAIDA["üìä SA√çDA"]
        G1["Dashboard<br/>Streamlit"]
        G2["Gr√°ficos PNG"]
        G3["Predi√ß√µes<br/>Tempo Real"]
        G4["Relat√≥rios"]
    end

    %% Conex√µes
    A1 & A2 & A3 -->|"Produ√ß√£o"| B1 & B2 & B3 & B4 & B5
    A4 -->|"Simula√ß√£o"| B1 & B2 & B3 & B4 & B5

    B1 & B2 & B3 & B4 & B5 --> C1
    C1 -->|"init_db.py"| C2
    C2 --> C3

    C3 --> D1
    D1 --> D2 --> D3 --> D4

    D4 --> E1 & E2 & E3
    D4 --> F1

    F1 --> F2 --> F3 --> F4

    E1 & E2 & E3 --> G1
    E2 --> G2
    F4 --> G3
    E3 --> G4

    %% Estilos
    style ENTRADA fill:#E3F2FD
    style COLETA fill:#E8F5E9
    style ARMAZENAMENTO fill:#FFF3E0
    style PROCESSAMENTO fill:#FCE4EC
    style ANALISE fill:#F3E5F5
    style ML fill:#FFEBEE
    style SAIDA fill:#E0F7FA
