%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#9C27B0'}}}%%

flowchart TB
    subgraph DADOS["üìä DADOS DE ENTRADA"]
        RAW["Dados Brutos<br/>200 registros"]
        FEAT["Features Selecionadas"]
        
        RAW --> FEAT
        
        subgraph FEATURES["Features"]
            F1["tempo_permanencia"]
            F2["hora"]
            F3["dia_semana"]
            F4["horario_pico"]
            F5["fim_semana"]
        end
        
        FEAT --> F1 & F2 & F3 & F4 & F5
    end

    subgraph PREP["‚öôÔ∏è PREPARA√á√ÉO"]
        ENCODE["Label Encoding<br/>curto=0, longo=1"]
        SCALE["StandardScaler<br/>Normaliza√ß√£o"]
        SPLIT["Train/Test Split<br/>80% / 20%"]
        
        F1 & F2 & F3 & F4 & F5 --> SCALE
        SCALE --> SPLIT
    end

    subgraph TREINO["üéØ TREINAMENTO"]
        DT["Decision Tree<br/>max_depth=5"]
        RF["Random Forest<br/>n_estimators=100"]
        CV["Cross Validation<br/>5-fold"]
        
        SPLIT -->|"X_train, y_train"| DT
        SPLIT -->|"X_train, y_train"| RF
        DT --> CV
        RF --> CV
    end

    subgraph AVALIACAO["üìà AVALIA√á√ÉO"]
        METRICS["M√©tricas"]
        CM["Matriz de Confus√£o"]
        FI["Feature Importance"]
        
        subgraph SCORES["Scores"]
            ACC["Acur√°cia"]
            PREC["Precis√£o"]
            REC["Recall"]
            F1S["F1-Score"]
        end
        
        CV --> METRICS
        METRICS --> ACC & PREC & REC & F1S
        CV --> CM
        CV --> FI
    end

    subgraph DEPLOY["üöÄ DEPLOY"]
        BEST["Sele√ß√£o Melhor Modelo<br/>Por F1-Score"]
        PKL["model.pkl<br/>Modelo Serializado"]
        PRED["Predi√ß√£o em Produ√ß√£o"]
        
        METRICS --> BEST
        BEST --> PKL
        PKL --> PRED
    end

    subgraph OUTPUT["üìä OUTPUT"]
        DASH["Dashboard<br/>Predi√ß√µes Real-time"]
        PLOTS["Visualiza√ß√µes<br/>confusion_matrix.png<br/>feature_importance.png"]
        
        PRED --> DASH
        CM & FI --> PLOTS
    end

    %% Estilos
    style DADOS fill:#E8F5E9
    style PREP fill:#E3F2FD
    style TREINO fill:#FFF3E0
    style AVALIACAO fill:#FCE4EC
    style DEPLOY fill:#F3E5F5
    style OUTPUT fill:#E0F7FA

    classDef feature fill:#C8E6C9,stroke:#388E3C
    classDef model fill:#FFECB3,stroke:#FFA000
    classDef metric fill:#F8BBD9,stroke:#C2185B

    class F1,F2,F3,F4,F5 feature
    class DT,RF model
    class ACC,PREC,REC,F1S metric
