%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4CAF50', 'secondaryColor': '#2196F3', 'tertiaryColor': '#FF9800'}}}%%

flowchart TB
    subgraph TOTEM["üñ•Ô∏è TOTEM F√çSICO"]
        direction TB
        ESP32["ESP32-CAM<br/>Detec√ß√£o de Presen√ßa"]
        MIC["üé§ Microfone<br/>Entrada de Voz"]
        TOUCH["üëÜ Tela Touch<br/>Interface T√°til"]
        SPEAKER["üîä Alto-falante<br/>Sa√≠da de √Åudio"]
    end

    subgraph SIMULACAO["üìä SIMULA√á√ÉO DE DADOS"]
        SIM_SCRIPT["simulated_sensors.py<br/>Gera√ß√£o de 200 registros"]
        CSV["simulated_sensors.csv<br/>Dataset Simulado"]
        SIM_SCRIPT --> CSV
    end

    subgraph DATABASE["üóÑÔ∏è BANCO DE DADOS"]
        INIT_DB["init_db.py<br/>Inicializa√ß√£o"]
        SQLITE[("totem.db<br/>SQLite")]
        INIT_DB --> SQLITE
    end

    subgraph ANALYSIS["üìà AN√ÅLISE DE DADOS"]
        ANALYSIS_SCRIPT["data_analysis.py<br/>Limpeza e An√°lise"]
        PLOTS["plots/<br/>Visualiza√ß√µes PNG"]
        CLEAN_DATA["cleaned_data.csv<br/>Dados Processados"]
        ANALYSIS_SCRIPT --> PLOTS
        ANALYSIS_SCRIPT --> CLEAN_DATA
    end

    subgraph ML["ü§ñ MACHINE LEARNING"]
        TRAIN["train_model.py<br/>Treinamento"]
        MODEL["model.pkl<br/>Modelo Salvo"]
        ML_PLOTS["plots/<br/>M√©tricas ML"]
        TRAIN --> MODEL
        TRAIN --> ML_PLOTS
    end

    subgraph DASHBOARD["üìä DASHBOARD"]
        STREAMLIT["app.py<br/>Streamlit"]
        KPIS["KPIs em Tempo Real"]
        GRAFICOS["Gr√°ficos Interativos"]
        PREDICAO["Predi√ß√£o ML"]
    end

    %% Fluxo de dados
    TOTEM -->|"Dados Reais<br/>(Futuro)"| DATABASE
    SIMULACAO -->|"Dados Simulados"| DATABASE
    CSV -->|"Leitura CSV"| INIT_DB
    
    DATABASE -->|"Query SQL"| ANALYSIS
    SQLITE -->|"Dados"| ANALYSIS_SCRIPT
    
    DATABASE -->|"Treino"| ML
    SQLITE -->|"Features"| TRAIN
    
    DATABASE -->|"Consulta"| DASHBOARD
    MODEL -->|"Modelo"| DASHBOARD
    
    STREAMLIT --> KPIS
    STREAMLIT --> GRAFICOS
    STREAMLIT --> PREDICAO

    %% Estilos
    classDef hardware fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef data fill:#E8F5E9,stroke:#388E3C,stroke-width:2px
    classDef process fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef ml fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    classDef dashboard fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px

    class ESP32,MIC,TOUCH,SPEAKER hardware
    class SIM_SCRIPT,CSV,INIT_DB,SQLITE data
    class ANALYSIS_SCRIPT,PLOTS,CLEAN_DATA process
    class TRAIN,MODEL,ML_PLOTS ml
    class STREAMLIT,KPIS,GRAFICOS,PREDICAO dashboard
